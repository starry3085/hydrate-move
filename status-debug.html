<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Debug</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div id="app">
        <header class="app-header">
            <h1>Office Wellness Reminder</h1>
            <p class="app-subtitle">Status Debug Test</p>
            <div class="app-status-summary" id="app-status-summary">
                <div class="status-indicator" id="app-status-indicator"></div>
                <span id="app-status-text">Wellness Reminders Inactive</span>
            </div>
        </header>

        <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px;">
            <button id="water-toggle" class="btn-primary">Start</button>
            <button id="posture-toggle" class="btn-primary">Start</button>
            <button id="start-all-btn" class="btn-primary">Start All</button>
            <button onclick="debugStatus()">Debug Status</button>
            <button onclick="manualUpdate()">Manual Update</button>
        </div>

        <div id="log" style="background: #f5f5f5; padding: 10px; margin: 10px 0; height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let waterActive = false;
        let postureActive = false;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateAppStatus() {
            const indicator = document.getElementById('app-status-indicator');
            const text = document.getElementById('app-status-text');
            
            log(`updateAppStatus called - water: ${waterActive}, posture: ${postureActive}`);
            
            if (!indicator || !text) {
                log('ERROR: Status elements not found!');
                return;
            }
            
            const isActive = waterActive || postureActive;
            log(`Combined active status: ${isActive}`);
            
            if (isActive) {
                indicator.classList.add('active');
                text.textContent = 'Wellness Reminders Active';
                log('Set status to ACTIVE');
            } else {
                indicator.classList.remove('active');
                text.textContent = 'Wellness Reminders Inactive';
                log('Set status to INACTIVE');
            }
            
            log(`Final indicator classes: "${indicator.className}"`);
            log(`Final text content: "${text.textContent}"`);
        }
        
        function debugStatus() {
            const indicator = document.getElementById('app-status-indicator');
            const text = document.getElementById('app-status-text');
            const waterBtn = document.getElementById('water-toggle');
            const postureBtn = document.getElementById('posture-toggle');
            
            log('=== DEBUG STATUS ===');
            log(`Indicator element: ${!!indicator}`);
            log(`Text element: ${!!text}`);
            log(`Water button: ${!!waterBtn}`);
            log(`Posture button: ${!!postureBtn}`);
            
            if (indicator) {
                log(`Indicator classes: "${indicator.className}"`);
                log(`Has active class: ${indicator.classList.contains('active')}`);
            }
            
            if (text) {
                log(`Text content: "${text.textContent}"`);
            }
            
            if (waterBtn) {
                log(`Water button text: "${waterBtn.textContent}"`);
                log(`Water button text trimmed: "${waterBtn.textContent.trim()}"`);
            }
            
            if (postureBtn) {
                log(`Posture button text: "${postureBtn.textContent}"`);
                log(`Posture button text trimmed: "${postureBtn.textContent.trim()}"`);
            }
            
            log(`waterActive: ${waterActive}`);
            log(`postureActive: ${postureActive}`);
            log(`Combined: ${waterActive || postureActive}`);
        }
        
        function manualUpdate() {
            log('Manual status update test...');
            waterActive = true;
            postureActive = true;
            updateAppStatus();
        }
        
        function setupButtons() {
            const waterToggle = document.getElementById('water-toggle');
            const postureToggle = document.getElementById('posture-toggle');
            const startAllBtn = document.getElementById('start-all-btn');
            
            if (waterToggle) {
                waterToggle.addEventListener('click', () => {
                    log('Water toggle clicked');
                    const isStart = waterToggle.textContent.trim() === 'Start';
                    log(`Water button is start: ${isStart}`);
                    
                    if (isStart) {
                        waterToggle.textContent = 'Pause';
                        waterToggle.className = 'btn-secondary';
                        waterActive = true;
                        log('Water set to active');
                    } else {
                        waterToggle.textContent = 'Start';
                        waterToggle.className = 'btn-primary';
                        waterActive = false;
                        log('Water set to inactive');
                    }
                    
                    updateAppStatus();
                });
            }
            
            if (postureToggle) {
                postureToggle.addEventListener('click', () => {
                    log('Posture toggle clicked');
                    const isStart = postureToggle.textContent.trim() === 'Start';
                    log(`Posture button is start: ${isStart}`);
                    
                    if (isStart) {
                        postureToggle.textContent = 'Pause';
                        postureToggle.className = 'btn-secondary';
                        postureActive = true;
                        log('Posture set to active');
                    } else {
                        postureToggle.textContent = 'Start';
                        postureToggle.className = 'btn-primary';
                        postureActive = false;
                        log('Posture set to inactive');
                    }
                    
                    updateAppStatus();
                });
            }
            
            if (startAllBtn) {
                startAllBtn.addEventListener('click', () => {
                    log('Start All clicked');
                    
                    if (waterToggle) {
                        log(`Water button text before: "${waterToggle.textContent}"`);
                        if (waterToggle.textContent.trim() === 'Start') {
                            log('Clicking water button');
                            waterToggle.click();
                        }
                    }
                    
                    if (postureToggle) {
                        log(`Posture button text before: "${postureToggle.textContent}"`);
                        if (postureToggle.textContent.trim() === 'Start') {
                            log('Clicking posture button');
                            postureToggle.click();
                        }
                    }
                });
            }
        }
        
        window.onload = function() {
            log('Page loaded');
            setupButtons();
            debugStatus();
        };
    </script>
</body>
</html>