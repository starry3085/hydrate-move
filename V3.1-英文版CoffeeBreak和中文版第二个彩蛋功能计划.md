# V3.1 英文版Coffee Break和中文版第二个彩蛋功能计划

## 功能需求分析

基于下午茶提醒功能的现有实现，需要实现两个新需求：

### 1. 英文版Coffee Break功能
- **域名**: hydrate-move.lightyearai.info
- **提醒标题**: Coffee Break
- **提醒内容**: Coffee, tea, or meme?
- **触发时间**: 每天下午3:15（与中文版下午茶时间一致）

### 2. 中文版第二个彩蛋功能
- **功能开关**: 在配置文件中可控制
- **提醒标题**: 开饭啦！
- **提醒内容**: 事已至此，先吃饭吧
- **触发时间**: 每天中午12:00

## 技术实现方案

### 现有架构分析
当前下午茶提醒功能采用以下架构：

1. **配置层** (<mcfile name="constants.js" path="e:\hydrate-move\js\constants.js"></mcfile>)
   - `AFTERNOON_TEA_CONSTANTS`: 包含功能开关、时间配置、语言检测
   - `NOTIFICATION_CONSTANTS`: 包含双语通知消息

2. **业务逻辑层** (<mcfile name="afternoon-tea-reminder.js" path="e:\hydrate-move\js\afternoon-tea-reminder.js"></mcfile>)
   - 继承 `ReminderManager` 类
   - 实现特定时间检查逻辑（每分钟检查一次）
   - 使用 localStorage 防止重复触发

3. **集成层** (<mcfile name="app.js" path="e:\hydrate-move\js\app.js"></mcfile>)
   - 在 `init()` 方法中调用 `initializeAfternoonTea()`
   - 依赖 `notificationService` 显示通知

### 实现计划

#### 第一步：扩展配置常量
在 <mcfile name="constants.js" path="e:\hydrate-move\js\constants.js"></mcfile> 中添加：

```javascript
/**
 * Coffee Break Easter Egg Configuration Constants (English Version)
 */
const COFFEE_BREAK_CONSTANTS = {
    // 功能开关 - 仅在英文版启用
    ENABLED: true,
    
    // 提醒时间配置 (24小时制)
    REMINDER_TIME: {
        HOUR: 15,     // 小时 (0-23)
        MINUTE: 15    // 分钟 (0-59)
    },
    
    // 显示配置
    DISPLAY: {
        DURATION_MS: 10000,  // 显示时长 (毫秒)
        POSITION: 'top-right' // 显示位置
    },
    
    // 域名检测 - 仅在英文版域名启用
    isEnglishVersionOnly() {
        return window.location.hostname === 'hydrate-move.lightyearai.info' && 
               document.documentElement.lang === 'en';
    },
    
    // 获取格式化的提醒时间字符串
    getReminderTimeString() {
        return `${this.REMINDER_TIME.HOUR.toString().padStart(2, '0')}:${this.REMINDER_TIME.MINUTE.toString().padStart(2, '0')}`;
    }
};

/**
 * Lunch Time Easter Egg Configuration Constants (Chinese Version)
 */
const LUNCH_TIME_CONSTANTS = {
    // 功能开关 - 可配置
    ENABLED: true,
    
    // 提醒时间配置 (24小时制)
    REMINDER_TIME: {
        HOUR: 12,     // 小时 (0-23)
        MINUTE: 0     // 分钟 (0-59)
    },
    
    // 显示配置
    DISPLAY: {
        DURATION_MS: 10000,  // 显示时长 (毫秒)
        POSITION: 'top-right' // 显示位置
    },
    
    // 语言检测 - 仅在中文版启用
    isChineseVersionOnly() {
        return document.documentElement.lang === 'zh-CN' && 
               window.location.pathname.includes('/zh/');
    },
    
    // 获取格式化的提醒时间字符串
    getReminderTimeString() {
        return `${this.REMINDER_TIME.HOUR.toString().padStart(2, '0')}:${this.REMINDER_TIME.MINUTE.toString().padStart(2, '0')}`;
    }
};
```

在 `NOTIFICATION_CONSTANTS` 中添加新的通知类型：

```javascript
MESSAGES: {
    // ... 现有配置
    COFFEE_BREAK: {
        'en': {
            TITLE: '☕ Coffee Break!',
            BODY: 'Coffee, tea, or meme?'
        }
    },
    LUNCH_TIME: {
        'zh-CN': {
            TITLE: '🍚 开饭啦！',
            BODY: '事已至此，先吃饭吧'
        }
    }
}
```

#### 第二步：创建新的提醒管理器类
基于 <mcfile name="afternoon-tea-reminder.js" path="e:\hydrate-move\js\afternoon-tea-reminder.js"></mcfile> 创建：

1. `coffee-break-reminder.js` - 英文版Coffee Break功能
2. `lunch-time-reminder.js` - 中文版午餐提醒功能

#### 第三步：扩展应用集成
在 <mcfile name="app.js" path="e:\hydrate-move\js\app.js"></mcfile> 中添加新的初始化方法：

```javascript
initializeCoffeeBreak() {
    // 类似下午茶提醒的实现，但使用英文版检测逻辑
}

initializeLunchTime() {
    // 类似下午茶提醒的实现，但使用中文版午餐配置
}
```

并在 `init()` 方法中调用这两个新方法。

#### 第四步：更新导出配置
确保新的常量被正确导出：

```javascript
// Export constants for use by other modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        REMINDER_CONSTANTS,
        UI_CONSTANTS,
        STORAGE_CONSTANTS,
        DEMO_CONSTANTS,
        NOTIFICATION_CONSTANTS,
        AFTERNOON_TEA_CONSTANTS,
        COFFEE_BREAK_CONSTANTS,
        LUNCH_TIME_CONSTANTS
    };
}

// Export for browser use
window.REMINDER_CONSTANTS = REMINDER_CONSTANTS;
window.UI_CONSTANTS = UI_CONSTANTS;
window.STORAGE_CONSTANTS = STORAGE_CONSTANTS;
window.DEMO_CONSTANTS = DEMO_CONSTANTS;
window.NOTIFICATION_CONSTANTS = NOTIFICATION_CONSTANTS;
window.AFTERNOON_TEA_CONSTANTS = AFTERNOON_TEA_CONSTANTS;
window.COFFEE_BREAK_CONSTANTS = COFFEE_BREAK_CONSTANTS;
window.LUNCH_TIME_CONSTANTS = LUNCH_TIME_CONSTANTS;
```

## MVP原则实施

### 最小化实现
1. **复用现有架构**: 完全基于下午茶提醒的成熟实现
2. **配置驱动**: 通过常量配置控制功能开关和内容
3. **渐进增强**: 新功能不影响核心提醒功能

### 优先级排序
1. **英文版Coffee Break** - 高优先级，面向国际用户
2. **中文版午餐提醒** - 中优先级，增强中文用户体验

### 风险控制
1. **功能隔离**: 每个彩蛋功能独立，互不影响
2. **错误处理**: 沿用现有的try-catch错误处理机制
3. **性能考虑**: 时间检查使用相同的每分钟检查机制

## 测试计划

### 单元测试
1. 配置常量验证
2. 语言和域名检测逻辑测试
3. 时间检查算法测试

### 集成测试
1. 英文版域名下的Coffee Break功能
2. 中文版下的午餐提醒功能
3. 功能开关测试

### 端到端测试
1. 特定时间点的自动触发测试
2. 防止重复触发机制测试
3. 通知显示和音效测试

## 部署计划

### 阶段一：代码实现
1. 配置常量扩展
2. 新的提醒管理器类创建
3. 应用集成

### 阶段二：测试验证
1. 本地功能测试
2. 跨浏览器兼容性测试

### 阶段三：生产部署
1. 英文版域名配置
2. 中文版功能开关配置
3. 监控和日志添加

## 预期成果

1. **英文版用户**: 每天下午3:15收到"Coffee Break"提醒
2. **中文版用户**: 每天中午12:00收到"开饭啦！"提醒
3. **可配置性**: 所有功能都有开关控制
4. **可扩展性**: 为未来更多彩蛋功能奠定基础

此计划完全遵循现有架构和最佳实践，确保代码质量和维护性。