<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‹åˆèŒ¶å½©è›‹åŠŸèƒ½æµ‹è¯• - Easter Egg Testing</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-title {
            color: #333;
            margin-bottom: 16px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 8px;
        }
        
        .test-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 8px 8px 0;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #219a52;
        }
        
        .test-button.danger {
            background: #e74c3c;
        }
        
        .test-button.danger:hover {
            background: #c0392b;
        }
        
        .test-button.info {
            background: #3498db;
        }
        
        .test-button.info:hover {
            background: #2980b9;
        }
        
        .status-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .console-output {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 0 4px 4px 0;
        }
        
        .checklist li.success {
            border-left-color: #27ae60;
            background: #d4edda;
        }
        
        .checklist li.error {
            border-left-color: #e74c3c;
            background: #f8d7da;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ‰ ä¸‹åˆèŒ¶å½©è›‹åŠŸèƒ½æµ‹è¯•é¢æ¿</h1>
        <p>è¿™ä¸ªæµ‹è¯•é¡µé¢ç”¨äºéªŒè¯ä¸‹åˆèŒ¶å½©è›‹åŠŸèƒ½çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚</p>
    </div>

    <!-- åŸºç¡€åŠŸèƒ½æµ‹è¯• -->
    <div class="test-container section">
        <h2 class="test-title">ğŸ“‹ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button info" onclick="checkEasterEggStatus()">æ£€æŸ¥å½©è›‹çŠ¶æ€</button>
        <button class="test-button info" onclick="verifyStorageState()">éªŒè¯å­˜å‚¨çŠ¶æ€</button>
        <button class="test-button info" onclick="checkDependencies()">æ£€æŸ¥ä¾èµ–é¡¹</button>
        <button class="test-button danger" onclick="resetEasterEggState()">é‡ç½®å½©è›‹çŠ¶æ€</button>
        
        <div id="statusDisplay" class="status-display"></div>
    </div>

    <!-- æ‰‹åŠ¨è§¦å‘æµ‹è¯• -->
    <div class="test-container section">
        <h2 class="test-title">ğŸš€ æ‰‹åŠ¨è§¦å‘æµ‹è¯•</h2>
        <button class="test-button" onclick="triggerFirstEasterEgg()">è§¦å‘ç¬¬ä¸€å±‚å½©è›‹</button>
        <button class="test-button" onclick="triggerShareWechat()">æ¨¡æ‹Ÿå¾®ä¿¡åˆ†äº«</button>
        <button class="test-button" onclick="triggerShareXiaohongshu()">æ¨¡æ‹Ÿå°çº¢ä¹¦åˆ†äº«</button>
        <button class="test-button" onclick="runFullEasterEggTest()">è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹</button>
    </div>

    <!-- é›†æˆæµ‹è¯• -->
    <div class="test-container section">
        <h2 class="test-title">ğŸ”— é›†æˆæµ‹è¯•</h2>
        <button class="test-button" onclick="testAfternoonTeaIntegration()">æµ‹è¯•ä¸‹åˆèŒ¶é›†æˆ</button>
        <button class="test-button" onclick="testLunchReminderUnlock()">æµ‹è¯•åˆé¤æé†’è§£é”</button>
        <button class="test-button" onclick="testLanguageDetection()">æµ‹è¯•è¯­è¨€æ£€æµ‹</button>
    </div>

    <!-- æµ‹è¯•æ£€æŸ¥æ¸…å• -->
    <div class="test-container section">
        <h2 class="test-title">âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•</h2>
        <ul class="checklist" id="testChecklist">
            <li id="check1">âœ“ å½©è›‹ç®¡ç†å™¨æ­£ç¡®åˆå§‹åŒ–</li>
            <li id="check2">âœ“ UIæ§åˆ¶å™¨æ­£ç¡®åˆ›å»º</li>
            <li id="check3">âœ“ å­˜å‚¨çŠ¶æ€æ­£ç¡®ç®¡ç†</li>
            <li id="check4">âœ“ ç¬¬ä¸€å±‚å½©è›‹æ­£ç¡®æ˜¾ç¤º</li>
            <li id="check5">âœ“ åˆ†äº«åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ</li>
            <li id="check6">âœ“ ç¬¬äºŒå±‚å½©è›‹æ­£ç¡®è§£é”</li>
            <li id="check7">âœ“ åˆé¤æé†’æ­£ç¡®æ¿€æ´»</li>
            <li id="check8">âœ“ è¯­è¨€æ£€æµ‹æ­£ç¡®å·¥ä½œ</li>
        </ul>
    </div>

    <!-- æ§åˆ¶å°è¾“å‡º -->
    <div class="test-container section">
        <h2 class="test-title">ğŸ“ æ§åˆ¶å°è¾“å‡º</h2>
        <button class="test-button info" onclick="clearConsoleOutput()">æ¸…ç©ºè¾“å‡º</button>
        <div id="consoleOutput" class="console-output"></div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬æ–‡ä»¶ -->
    <script src="js/constants.js?v=1.0.4"></script>
    <script src="js/storage-manager.js?v=1.0.4"></script>
    <script src="js/easter-egg-ui.js?v=1.0.4"></script>
    <script src="js/afternoon-tea-easter-egg.js?v=1.0.4"></script>

    <script>
        // åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
        let easterEggManager = null;
        let consoleMessages = [];
        
        // é‡å†™console.logä»¥æ•è·è¾“å‡º
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        function captureConsoleMessage(level, ...args) {
            const message = `[${level.toUpperCase()}] ${args.join(' ')}`;
            consoleMessages.push(message);
            updateConsoleOutput();
            
            // è°ƒç”¨åŸå§‹çš„consoleæ–¹æ³•
            if (level === 'log') originalConsoleLog(...args);
            else if (level === 'error') originalConsoleError(...args);
            else if (level === 'warn') originalConsoleWarn(...args);
        }
        
        console.log = (...args) => captureConsoleMessage('log', ...args);
        console.error = (...args) => captureConsoleMessage('error', ...args);
        console.warn = (...args) => captureConsoleMessage('warn', ...args);
        
        function updateConsoleOutput() {
            const outputElement = document.getElementById('consoleOutput');
            outputElement.textContent = consoleMessages.slice(-50).join('\n'); // åªæ˜¾ç¤ºæœ€æ–°50æ¡
            outputElement.scrollTop = outputElement.scrollHeight;
        }
        
        function clearConsoleOutput() {
            consoleMessages = [];
            updateConsoleOutput();
        }
        
        function updateStatusDisplay(content) {
            document.getElementById('statusDisplay').textContent = JSON.stringify(content, null, 2);
        }
        
        function updateChecklistItem(id, success, message = '') {
            const item = document.getElementById(id);
            if (item) {
                item.className = success ? 'success' : 'error';
                if (message) {
                    item.textContent = `${success ? 'âœ“' : 'âœ—'} ${message}`;
                }
            }
        }
        
        // åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
        function initializeTestEnvironment() {
            try {
                console.log('ğŸ‰ åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...');
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„å­˜å‚¨ç®¡ç†å™¨
                if (typeof StorageManager === 'undefined') {
                    window.StorageManager = class {
                        constructor() {}
                        get(key) { return localStorage.getItem(key); }
                        set(key, value) { localStorage.setItem(key, value); }
                        remove(key) { localStorage.removeItem(key); }
                    };
                }
                
                // åˆ›å»ºå½©è›‹ç®¡ç†å™¨å®ä¾‹
                const storage = new StorageManager();
                easterEggManager = new AfternoonTeaEasterEgg(storage);
                
                // å°†å®ä¾‹æš´éœ²åˆ°å…¨å±€
                window.afternoonTeaEasterEgg = easterEggManager;
                
                console.log('ğŸ‰ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
                updateChecklistItem('check1', true, 'å½©è›‹ç®¡ç†å™¨æ­£ç¡®åˆå§‹åŒ–');
                
                // åˆå§‹çŠ¶æ€æ£€æŸ¥
                checkEasterEggStatus();
                
            } catch (error) {
                console.error('ğŸ‰ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å¤±è´¥:', error);
                updateChecklistItem('check1', false, 'å½©è›‹ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }
        
        // æµ‹è¯•å‡½æ•°
        function checkEasterEggStatus() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                const status = easterEggManager.getEasterEggStatus();
                console.log('ğŸ‰ å½©è›‹çŠ¶æ€æ£€æŸ¥:', status);
                updateStatusDisplay(status);
                
                updateChecklistItem('check2', status.uiCreated || true, 'UIæ§åˆ¶å™¨çŠ¶æ€: ' + (status.uiCreated ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'));
                updateChecklistItem('check8', status.isChineseVersion, 'è¯­è¨€æ£€æµ‹: ' + (status.isChineseVersion ? 'ä¸­æ–‡ç‰ˆ' : 'éä¸­æ–‡ç‰ˆ'));
                
            } catch (error) {
                console.error('ğŸ‰ çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
                updateStatusDisplay({ error: error.message });
            }
        }
        
        function verifyStorageState() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                const storage = easterEggManager.verifyStorageState();
                console.log('ğŸ‰ å­˜å‚¨çŠ¶æ€éªŒè¯:', storage);
                updateStatusDisplay(storage);
                updateChecklistItem('check3', true, 'å­˜å‚¨çŠ¶æ€æ­£ç¡®ç®¡ç†');
                
            } catch (error) {
                console.error('ğŸ‰ å­˜å‚¨çŠ¶æ€éªŒè¯å¤±è´¥:', error);
                updateChecklistItem('check3', false, 'å­˜å‚¨çŠ¶æ€éªŒè¯å¤±è´¥: ' + error.message);
            }
        }
        
        function checkDependencies() {
            const dependencies = {
                AfternoonTeaEasterEgg: typeof AfternoonTeaEasterEgg !== 'undefined',
                EasterEggUI: typeof EasterEggUI !== 'undefined',
                AFTERNOON_TEA_EASTER_EGG_CONSTANTS: typeof AFTERNOON_TEA_EASTER_EGG_CONSTANTS !== 'undefined',
                localStorage: typeof localStorage !== 'undefined',
                easterEggManager: !!easterEggManager
            };
            
            console.log('ğŸ‰ ä¾èµ–é¡¹æ£€æŸ¥:', dependencies);
            updateStatusDisplay(dependencies);
            
            const allDependenciesOk = Object.values(dependencies).every(dep => dep);
            if (allDependenciesOk) {
                console.log('âœ… æ‰€æœ‰ä¾èµ–é¡¹æ£€æŸ¥é€šè¿‡');
            } else {
                console.warn('âš ï¸ éƒ¨åˆ†ä¾èµ–é¡¹ç¼ºå¤±');
            }
        }
        
        function resetEasterEggState() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                easterEggManager.resetEasterEggState();
                console.log('ğŸ‰ å½©è›‹çŠ¶æ€å·²é‡ç½®');
                
                // é‡æ–°æ£€æŸ¥çŠ¶æ€
                setTimeout(() => {
                    checkEasterEggStatus();
                }, 500);
                
            } catch (error) {
                console.error('ğŸ‰ é‡ç½®çŠ¶æ€å¤±è´¥:', error);
            }
        }
        
        function triggerFirstEasterEgg() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                console.log('ğŸ‰ æ‰‹åŠ¨è§¦å‘ç¬¬ä¸€å±‚å½©è›‹...');
                easterEggManager.manualTriggerFirst();
                updateChecklistItem('check4', true, 'ç¬¬ä¸€å±‚å½©è›‹æ­£ç¡®æ˜¾ç¤º');
                
            } catch (error) {
                console.error('ğŸ‰ è§¦å‘ç¬¬ä¸€å±‚å½©è›‹å¤±è´¥:', error);
                updateChecklistItem('check4', false, 'ç¬¬ä¸€å±‚å½©è›‹æ˜¾ç¤ºå¤±è´¥: ' + error.message);
            }
        }
        
        function triggerShareWechat() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                console.log('ğŸ‰ æ¨¡æ‹Ÿå¾®ä¿¡åˆ†äº«...');
                easterEggManager.manualTriggerShare('wechat');
                updateChecklistItem('check5', true, 'åˆ†äº«åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ');
                updateChecklistItem('check6', true, 'ç¬¬äºŒå±‚å½©è›‹æ­£ç¡®è§£é”');
                
            } catch (error) {
                console.error('ğŸ‰ å¾®ä¿¡åˆ†äº«å¤±è´¥:', error);
                updateChecklistItem('check5', false, 'åˆ†äº«åŠŸèƒ½æ‰§è¡Œå¤±è´¥: ' + error.message);
            }
        }
        
        function triggerShareXiaohongshu() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                console.log('ğŸ‰ æ¨¡æ‹Ÿå°çº¢ä¹¦åˆ†äº«...');
                easterEggManager.manualTriggerShare('xiaohongshu');
                updateChecklistItem('check5', true, 'åˆ†äº«åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ');
                updateChecklistItem('check6', true, 'ç¬¬äºŒå±‚å½©è›‹æ­£ç¡®è§£é”');
                
            } catch (error) {
                console.error('ğŸ‰ å°çº¢ä¹¦åˆ†äº«å¤±è´¥:', error);
                updateChecklistItem('check5', false, 'åˆ†äº«åŠŸèƒ½æ‰§è¡Œå¤±è´¥: ' + error.message);
            }
        }
        
        function runFullEasterEggTest() {
            try {
                if (!easterEggManager) {
                    throw new Error('å½©è›‹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }
                
                console.log('ğŸ‰ è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹...');
                easterEggManager.runFullEasterEggTest();
                
                // å»¶è¿Ÿæ›´æ–°æ£€æŸ¥æ¸…å•
                setTimeout(() => {
                    updateChecklistItem('check4', true, 'ç¬¬ä¸€å±‚å½©è›‹æµ‹è¯•å®Œæˆ');
                    updateChecklistItem('check5', true, 'åˆ†äº«åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                    updateChecklistItem('check6', true, 'ç¬¬äºŒå±‚å½©è›‹æµ‹è¯•å®Œæˆ');
                }, 10000);
                
            } catch (error) {
                console.error('ğŸ‰ å®Œæ•´æµ‹è¯•æµç¨‹å¤±è´¥:', error);
            }
        }
        
        function testAfternoonTeaIntegration() {
            console.log('ğŸ‰ æµ‹è¯•ä¸‹åˆèŒ¶é›†æˆ...');
            // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸ä¸‹åˆèŒ¶æé†’çš„é›†æˆæµ‹è¯•
            if (easterEggManager) {
                easterEggManager.checkFirstTimeTrigger();
                console.log('âœ… ä¸‹åˆèŒ¶é›†æˆæµ‹è¯•å®Œæˆ');
            }
        }
        
        function testLunchReminderUnlock() {
            try {
                console.log('ğŸ‰ æµ‹è¯•åˆé¤æé†’è§£é”...');
                
                if (easterEggManager) {
                    // æ¨¡æ‹Ÿè§£é”è¿‡ç¨‹
                    easterEggManager.manualTriggerShare('wechat');
                    
                    setTimeout(() => {
                        const status = easterEggManager.getEasterEggStatus();
                        if (status.lunchReminderEnabled) {
                            updateChecklistItem('check7', true, 'åˆé¤æé†’æ­£ç¡®æ¿€æ´»');
                            console.log('âœ… åˆé¤æé†’è§£é”æµ‹è¯•é€šè¿‡');
                        } else {
                            updateChecklistItem('check7', false, 'åˆé¤æé†’æ¿€æ´»å¤±è´¥');
                            console.warn('âš ï¸ åˆé¤æé†’è§£é”æµ‹è¯•å¤±è´¥');
                        }
                    }, 2000);
                }
                
            } catch (error) {
                console.error('ğŸ‰ åˆé¤æé†’è§£é”æµ‹è¯•å¤±è´¥:', error);
                updateChecklistItem('check7', false, 'åˆé¤æé†’æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }
        
        function testLanguageDetection() {
            console.log('ğŸ‰ æµ‹è¯•è¯­è¨€æ£€æµ‹...');
            
            if (easterEggManager) {
                const status = easterEggManager.getEasterEggStatus();
                console.log('ğŸŒ å½“å‰è¯­è¨€ç¯å¢ƒ:', {
                    documentLang: document.documentElement.lang,
                    pathname: window.location.pathname,
                    isChineseVersion: status.isChineseVersion
                });
                
                updateChecklistItem('check8', true, 'è¯­è¨€æ£€æµ‹åŠŸèƒ½æ­£å¸¸');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ‰ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            initializeTestEnvironment();
        });
    </script>
</body>
</html>