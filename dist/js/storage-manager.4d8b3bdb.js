class StorageManager{constructor(){this.storagePrefix="wellness_reminder_",this.isStorageAvailable=this.checkStorageAvailability(),this.memoryStorage=new Map}checkStorageAvailability(){try{const e=this.storagePrefix+"test";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage不可用，将使用内存存储:",e),!1}}saveSettings(e,t){try{const r=this.storagePrefix+e,a=JSON.stringify(t);return this.isStorageAvailable?localStorage.setItem(r,a):this.memoryStorage.set(r,a),!0}catch(r){console.error("保存设置失败:",r);try{const r=this.storagePrefix+e;return this.memoryStorage.set(r,JSON.stringify(t)),!0}catch(e){return console.error("内存存储也失败:",e),!1}}}loadSettings(e){try{const t=this.storagePrefix+e;let r=null;return r=this.isStorageAvailable?localStorage.getItem(t):this.memoryStorage.get(t),null==r?null:JSON.parse(r)}catch(e){return console.error("加载设置失败:",e),null}}clearAllData(){try{if(this.isStorageAvailable){const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&r.startsWith(this.storagePrefix)&&e.push(r)}e.forEach(e=>localStorage.removeItem(e))}return this.memoryStorage.clear(),!0}catch(e){return console.error("清除数据失败:",e),!1}}isAvailable(){return this.isStorageAvailable}getStorageInfo(){if(!this.isStorageAvailable)return{available:!1,used:this.memoryStorage.size,type:"memory"};try{let e=0,t=0;for(let r in localStorage)if(localStorage.hasOwnProperty(r)){const a=localStorage[r].length;e+=a,r.startsWith(this.storagePrefix)&&(t+=a)}return{available:!0,totalUsed:e,appUsed:t,type:"localStorage"}}catch(e){return console.error("获取存储信息失败:",e),{available:!1,error:e.message,type:"localStorage"}}}backupData(){try{const e={};if(this.isStorageAvailable)for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);if(r&&r.startsWith(this.storagePrefix)){const t=r.replace(this.storagePrefix,"");e[t]=JSON.parse(localStorage.getItem(r))}}else this.memoryStorage.forEach((t,r)=>{if(r.startsWith(this.storagePrefix)){const a=r.replace(this.storagePrefix,"");e[a]=JSON.parse(t)}});return e}catch(e){return console.error("备份数据失败:",e),null}}restoreData(e){try{if(!e||"object"!=typeof e)throw new Error("无效的备份数据");for(const[t,r]of Object.entries(e))this.saveSettings(t,r);return!0}catch(e){return console.error("恢复数据失败:",e),!1}}}"undefined"!=typeof module&&module.exports&&(module.exports=StorageManager);