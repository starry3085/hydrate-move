class MobileAdapter{constructor(e){this.errorHandler=e||(window.ErrorHandler?new window.ErrorHandler:null),this.features={localStorage:!1,notifications:!1,audio:!1,serviceWorker:!1,pageVisibility:!1,touchEvents:!1},this.detectFeatures()}detectFeatures(){this.features.localStorage=this.isLocalStorageAvailable(),this.features.notifications="Notification"in window,this.features.audio="Audio"in window,this.features.serviceWorker="serviceWorker"in navigator,this.features.pageVisibility="hidden"in document,this.features.touchEvents="ontouchstart"in window||navigator.maxTouchPoints>0,console.log("浏览器功能支持检测结果:",this.features)}isLocalStorageAvailable(){try{const e="__test__";localStorage.setItem(e,e);const t=localStorage.getItem(e)===e;return localStorage.removeItem(e),t}catch(e){return!1}}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}isIOSDevice(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}isAndroidDevice(){return/Android/i.test(navigator.userAgent)}getBrowserInfo(){const e=navigator.userAgent;let t="未知浏览器",i="";return e.indexOf("Firefox")>-1?(t="Firefox",i=e.match(/Firefox\/([\d.]+)/)[1]):e.indexOf("Edge")>-1||e.indexOf("Edg")>-1?(t="Edge",i=e.match(/Edge?\/([\d.]+)/)[1]):e.indexOf("Chrome")>-1?(t="Chrome",i=e.match(/Chrome\/([\d.]+)/)[1]):e.indexOf("Safari")>-1?(t="Safari",i=e.match(/Version\/([\d.]+)/)[1]):(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(t="Internet Explorer",i=e.match(/(?:MSIE |rv:)([\d.]+)/)[1]),{name:t,version:i,userAgent:e,isMobile:this.isMobileDevice(),isIOS:this.isIOSDevice(),isAndroid:this.isAndroidDevice()}}applyMobileAdaptation(){this.isMobileDevice()&&(document.body.classList.add("mobile-device"),this.isIOSDevice()&&document.body.classList.add("ios-device"),this.isAndroidDevice()&&document.body.classList.add("android-device"),this.isIOSDevice()&&this.handleIOSSpecifics(),console.log("已应用移动端适配"))}handleIOSSpecifics(){document.addEventListener("touchstart",()=>{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createBuffer(1,1,22050),i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.start(0),i.stop(0),document.removeEventListener("touchstart",arguments.callee)},{once:!0})}checkFeaturesAndFallbacks(){const e={supported:{...this.features},fallbacks:{}};return this.features.localStorage||(e.fallbacks.localStorage={message:"本地存储不可用，设置将无法保存",solution:"使用内存存储"},this.errorHandler&&this.errorHandler.handleError({type:"compatibility",message:"本地存储不可用，设置将无法在会话结束后保存",timestamp:Date.now()})),this.features.notifications||(e.fallbacks.notifications={message:"浏览器通知不可用，将使用页面内通知",solution:"使用页面内通知"},this.errorHandler&&this.errorHandler.handleError({type:"compatibility",message:"浏览器通知不可用，将使用页面内通知",timestamp:Date.now()})),this.features.audio||(e.fallbacks.audio={message:"音频功能不可用，将使用静音通知",solution:"使用静音通知"},this.errorHandler&&this.errorHandler.handleError({type:"compatibility",message:"音频功能不可用，将使用静音通知",timestamp:Date.now()})),e}showCompatibilityNotice(e){const t=this.getBrowserInfo(),i=this.checkFeaturesAndFallbacks();if(Object.values(i.supported).includes(!1)){const o=document.createElement("div");o.className="compatibility-notice";let r=`\n                <div class="compatibility-header">\n                    <h3>浏览器兼容性提示</h3>\n                    <button class="btn-close" id="compatibility-close">✕</button>\n                </div>\n                <div class="compatibility-content">\n                    <p>检测到您正在使用 ${t.name} ${t.version}，某些功能可能受限：</p>\n                    <ul>\n            `;i.supported.localStorage||(r+="<li>本地存储不可用，您的设置将无法在会话结束后保存</li>"),i.supported.notifications||(r+="<li>浏览器通知不可用，将使用页面内通知代替</li>"),i.supported.audio||(r+="<li>音频功能不可用，提醒将不会播放声音</li>"),r+='\n                    </ul>\n                    <p>为了获得最佳体验，建议使用最新版本的Chrome、Firefox、Safari或Edge浏览器。</p>\n                </div>\n                <div class="compatibility-footer">\n                    <button class="btn-primary" id="compatibility-understand">我知道了</button>\n                </div>\n            ',o.innerHTML=r,e?(e.appendChild(o),document.getElementById("compatibility-close").addEventListener("click",()=>{o.remove()}),document.getElementById("compatibility-understand").addEventListener("click",()=>{o.remove()})):console.warn("未提供容器元素，无法显示兼容性提示")}}}window.MobileAdapter=MobileAdapter;