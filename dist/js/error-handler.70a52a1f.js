class ErrorHandler{constructor(){this.errorLog=[],this.maxLogSize=50,this.setupGlobalErrorHandling()}setupGlobalErrorHandling(){window.addEventListener("unhandledrejection",r=>{this.handleError({type:"promise",error:r.reason,message:r.reason?.message||"未处理的Promise错误",timestamp:Date.now()})}),window.addEventListener("error",r=>{this.handleError({type:"runtime",error:r.error,message:r.message,source:r.filename,lineno:r.lineno,colno:r.colno,timestamp:Date.now()}),r.preventDefault()})}handleError(r){switch(console.error("应用错误:",r),this.logError(r),r.type){case"storage":return this.handleStorageError(r);case"notification":return this.handleNotificationError(r);case"audio":return this.handleAudioError(r);case"timer":return this.handleTimerError(r);case"compatibility":return this.handleCompatibilityError(r);default:return this.handleGenericError(r)}}logError(r){this.errorLog.length>=this.maxLogSize&&this.errorLog.shift(),this.errorLog.push(r);try{localStorage.setItem("errorLog",JSON.stringify(this.errorLog))}catch(r){console.warn("无法保存错误日志到本地存储")}}handleStorageError(r){return console.warn("存储功能不可用，将使用内存存储"),{title:"存储功能受限",message:"本地存储不可用，您的设置将无法在会话结束后保存",type:"warning",solution:"请检查浏览器设置，确保允许网站使用本地存储"}}handleNotificationError(r){return console.warn("通知功能不可用，将使用页面内通知"),{title:"通知功能受限",message:"系统通知功能不可用，将使用页面内通知代替",type:"info",solution:"请检查浏览器通知权限设置"}}handleAudioError(r){return console.warn("音频功能不可用，将使用静音通知"),{title:"音频功能受限",message:"提醒音效无法播放，将使用静音通知",type:"info",solution:"请检查浏览器音频权限设置"}}handleTimerError(r){return console.warn("定时器错误，将重新初始化计时器"),{title:"计时器错误",message:"提醒计时器出现问题，已自动重置",type:"warning",solution:"如果问题持续出现，请刷新页面"}}handleCompatibilityError(r){return console.warn("浏览器兼容性问题:",r.message),{title:"浏览器兼容性问题",message:r.message||"您的浏览器可能不支持某些功能",type:"warning",solution:"请尝试使用最新版本的Chrome、Firefox、Safari或Edge浏览器"}}handleGenericError(r){return console.error("未分类错误:",r),{title:"应用错误",message:"应用遇到了一个问题",type:"error",solution:"请刷新页面重试，如果问题持续出现，请清除浏览器缓存"}}getUserFriendlyError(r){if(r.message&&"string"==typeof r.message){if(r.message.includes("localStorage")||r.message.includes("storage"))return this.handleStorageError({type:"storage",error:r});if(r.message.includes("notification")||r.message.includes("permission"))return this.handleNotificationError({type:"notification",error:r});if(r.message.includes("audio")||r.message.includes("play"))return this.handleAudioError({type:"audio",error:r});if(r.message.includes("timer")||r.message.includes("interval"))return this.handleTimerError({type:"timer",error:r})}return this.handleGenericError({type:"generic",error:r})}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[];try{localStorage.removeItem("errorLog")}catch(r){}}}window.ErrorHandler=ErrorHandler;